{
    "app-id": "org.kde.KStars",
    "runtime": "org.kde.Platform",
    "runtime-version": "5.11",
    "sdk": "org.kde.Sdk",
    "command": "kstars",
    "finish-args": [
        "--socket=x11",
        "--socket=wayland"
    ],
    "modules": [
        {
            "name": "eigen",
            "buildsystem": "cmake-ninja",
            "builddir": true,
            "cleanup": "*",
            "sources": [
                {
                    "type": "archive",
                    "url": "https://bitbucket.org/eigen/eigen/get/3.3.5.tar.bz2",
                    "sha256": "7352bff3ea299e4c7d7fbe31c504f8eb9149d7e685dec5a12fbaa26379f603e2"
                }
            ]
        },
        {
            "name": "libraw",
            "config-opts": [
                "--disable-static"
            ],
            "cleanup": [
                "/bin",
                "/share/doc"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://www.libraw.org/data/LibRaw-0.19.0.tar.gz",
                    "sha256": "e83f51e83b19f9ba6b8bd144475fc12edf2d7b3b930d8d280bdebd8a8f3ed259"
                }
            ]
        },
        {
            "name": "cfitsio",
            "make-args": ["shared"], /* Build breaks without shared library (undefined references to libcurl */
            "sources": [
                {
                    "type": "archive",
                    "url": "http://heasarc.gsfc.nasa.gov/FTP/software/fitsio/c/cfitsio3450.tar.gz",
                    "sha256": "bf6012dbe668ecb22c399c4b7b2814557ee282c74a7d5dc704eb17c30d9fb92e"
                }
            ]
        },
        {
            "name": "wcslib",
            "sources": [
                {
                    "type": "archive",
                    "url": "ftp://ftp.atnf.csiro.au/pub/software/wcslib/wcslib-5.19.1.tar.bz2",
                    "sha256": "59b9f0e5a2c040773cc846c684d84c09b986c1393e97b378a41b92d9d3df0f98"
                }
            ]
        },
        { /* Dependency for indi */
            "name": "libnova",
            "rm-configure": true,
            "sources": [
                {
                    "type": "archive",
                    "url": "http://downloads.sourceforge.net/sourceforge/libnova/libnova-0.15.0.tar.gz",
                    "sha256": "7c5aa33e45a3e7118d77df05af7341e61784284f1e8d0d965307f1663f415bb1"
                },
                {
                    "type": "script",
                    "commands": ["autoreconf -fiv"],
                    "dest-filename": "autogen.sh"
                }
            ]
        },
        { /* Dependency for indi */
            "name": "libusb",
            "config-opts": [ "--disable-static", "--disable-udev" ],
            "cleanup": [
                "/lib/*.la",
                "/lib/pkgconfig",
                "/include"
            ],
            "sources": [
                {
                "type":"archive",
                "url":"https://github.com/libusb/libusb/archive/v1.0.22.tar.gz",
                "sha256": "3500f7b182750cd9ccf9be8b1df998f83df56a39ab264976bdb3307773e16f48"
                }
            ]
        },
        { /* Dependency for indi */
            "name": "gsl",
            "sources": [
                {
                    "type": "archive",
                    "url": "http://ftp.halifax.rwth-aachen.de/gnu/gsl/gsl-2.5.tar.gz",
                    "sha256": "0460ad7c2542caaddc6729762952d345374784100223995eb14d614861f2258d"
                }
            ]
        },
        {
            "name": "indi",
            "buildsystem": "cmake",
            "config-opts": [
                "-DUDEVRULES_INSTALL_DIR=/app/etc/udev/rules.d"
            ],
            "subdir": "libindi",
            "sources": [
                {
                    "type": "archive",
                    "url": "https://github.com/indilib/indi/archive/v1.7.4.tar.gz",
                    "sha256": "214132d011ca4cf72cb6408dae0a3b6f96fed1e8ef988738b4b50c64916c3d99"
                }
            ]
        },
        {
            "name": "qtkeychain",
            "buildsystem": "cmake",
            "config-opts": [
                "-DCMAKE_INSTALL_LIBDIR=/app/lib",
                "-DLIB_INSTALL_DIR=/app/lib",
                "-DBUILD_TRANSLATIONS=NO"
            ],
            "sources": [
                {
                    "type": "archive", 
                    "url": "https://github.com/frankosterfeld/qtkeychain/archive/v0.9.0.tar.gz",
                    "sha256": "0935e5eb67fbed0b2db5e74ea8cbd667c6be6eed3767f212eac6ac318ab8a6fc"
                }
            ]
        },
        { /* Move up to xplanet */
            "name": "atrometrynet",
            "sources": [
                {
                    "type": "archive",
                    "url": "http://astrometry.net/downloads/astrometry.net-0.76.tar.gz",
                    "sha256": "244355ef9716a9e062eb19e8547e8b50434c7df52a8b96f9d0a254bc646d1f0d"
                }
            ]
        },
        {
            "name": "qtdatavis3d",
            "buildsystem": "qmake",
            "make-install-args": ["INSTALL_ROOT=/app/install"],
            "post-install" : [
                "mv /app/install/usr/* /app/",
                "rmdir /app/install/usr",
                "rmdir /app/install",
                "sed -i 's|/usr/|/app/|' /app/lib/cmake/Qt5DataVisualization/Qt5DataVisualizationConfig.cmake",
                "sed -i 's|/usr/|/app/|' /app/lib/pkgconfig/Qt5DataVisualization.pc",
                "sed -i 's|/usr/|/app/|' /app/lib/libQt5DataVisualization.la"
            ],
            "sources": [
                {
                    "type": "archive", 
                    "url": "https://download.qt.io/official_releases/qt/5.11/5.11.1/submodules/qtdatavis3d-everywhere-src-5.11.1.tar.xz",
                    "sha256": "1c9da0876e0058bff1c24e0088505aff469e2e2cc983143acdae17f075035e3d"
                }
            ]
        },
        {
            "name": "xplanet",
            "sources": [
                {
                    "type": "archive",
                    "url": "http://downloads.sourceforge.net/project/xplanet/xplanet/1.3.1/xplanet-1.3.1.tar.gz",
                    "sha256": "4380d570a8bf27b81fb629c97a636c1673407f4ac4989ce931720078a90aece7"
                },
                {
                    "type": "patch",
                    "path": "remove_NULL_comparison_for_getline_calls.patch"
                },
                {
                    "type": "patch",
                    "path": "giflib6.patch"
                }
            ]
        },
        {
            "name": "kstars",
            "buildsystem": "cmake",
            "config-opts": [
                "-DBUILD_TESTING=OFF"
            ],
            "sources": [
                {
                    "type": "git",
                    "path": "/mnt/hdd/kde/kstars"
                }
            ]
        }
    ]
}
